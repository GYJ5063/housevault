import React from "react";
import ValuationForm from '../components/forms/ValuationForm'
import "../styles/valuation.scss";
import ValuationReport from "../components/valuation/ValuationReport";
import _ from "lodash";
import { graphql, compose } from 'react-apollo';
import gql from 'graphql-tag';


class QuickValuation extends React.Component {

    constructor(props) {
        super(props);
        this.state = {
            //report: {},
            report: { "selling_results": { "predict_results": { "predict_price": 331500, "probability": 0.646, "exist_in_epc": false, "predict_price_low": 287500, "band": 0.133, "address_1": "No Data", "predict_price_up": 375500, "lat": 51.63916499, "lng": -1.86261753, "confidence_level": 6 }, "query_info": { "address_id": 24868766, "number_habitable_rooms": 5, "built_from": "Semi-Detached", "total_floor_area": 100, "wall_type": "cavity wall", "property_type": "House" }, "regional_price_5y": { "index_10": 224000, "index_11": 224000, "index_12": 225500, "index_13": 230000, "index_14": 238000, "index_15": 242500, "index_16": 243500, "index_17": 247000, "index_18": 251000, "index_19": 251000, "index_30": 271000, "index_31": 277500, "regional_name": "Wiltshire", "index_29": 270500, "index_28": 272000, "index_21": 259000, "index_20": 258500, "index_23": 262000, "index_22": 255000, "index_25": 266500, "index_24": 260000, "index_27": 274000, "index_26": 275500, "area_code": "E06000054", "index_8": 221500, "index_9": 227500, "index_6": 212500, "index_7": 214500, "index_4": 214500, "index_5": 212000, "index_2": 209000, "index_3": 216500, "index_1": 208500 }, "local_property_type_statistic": { "Flat_average_value": 0, "Semi_Detached_num_ratio": 0.161, "Semi_Detached_per_size_value": 3357, "Detached_average_value": 428000, "Terrace_average_size": 73, "Detached_average_size": 116, "Semi_Detached_average_size": 77, "Detached_per_size_value": 3692, "Flat_average_size": 0, "Flat_num_ratio": 0, "Flat_per_size_value": 0, "Semi_Detached_average_value": 258500, "Detached_num_ratio": 0.742, "Terrace_num_ratio": 0.097, "Terrace_average_value": 239500, "Terrace_per_size_value": 3283 }, "comparable_properties": { "0": { "sold_date": "2017-11-24", "distance": 0, "address_id": 24868810, "current_valuation": 249500, "sold_price": 245000, "rooms": 5, "lat": 51.63916499, "address_1": "92 Deansfield", "lng": -1.86261753, "size": 84, "house_type_out": "Semi-Detached House", "postcode": "SN6 6BW" }, "1": { "sold_date": "2015-10-01", "distance": 0, "address_id": 24868793, "current_valuation": 263000, "sold_price": 228000, "rooms": 4, "lat": 51.63916499, "address_1": "75 Deansfield", "lng": -1.86261753, "size": 69, "house_type_out": "Semi-Detached House", "postcode": "SN6 6BW" }, "2": { "sold_date": "2015-05-06", "distance": 0, "address_id": 24868790, "current_valuation": 251500, "sold_price": 205000, "rooms": 5, "lat": 51.63916499, "address_1": "72 Deansfield", "lng": -1.86261753, "size": 78, "house_type_out": "Semi-Detached House", "postcode": "SN6 6BW" }, "3": { "sold_date": "2014-08-08", "distance": 0, "address_id": 24868808, "current_valuation": 290000, "sold_price": 229950, "rooms": 6, "lat": 51.63916499, "address_1": "90 Deansfield", "lng": -1.86261753, "size": 95, "house_type_out": "Semi-Detached House", "postcode": "SN6 6BW" }, "4": { "sold_date": "2016-12-15", "distance": 116, "address_id": 24868684, "current_valuation": 314000, "sold_price": 290000, "rooms": 5, "lat": 51.63865421, "address_1": "61 Deansfield", "lng": -1.86409297, "size": 96, "house_type_out": "Detached House", "postcode": "SN6 6BP" }, "5": { "sold_date": "2016-10-06", "distance": 116, "address_id": 24868641, "current_valuation": 337500, "sold_price": 315000, "rooms": 7, "lat": 51.63865421, "address_1": "22 Deansfield", "lng": -1.86409297, "size": 98, "house_type_out": "Detached House", "postcode": "SN6 6BP" }, "6": { "sold_date": "2016-05-20", "distance": 116, "address_id": 24868639, "current_valuation": 305000, "sold_price": 275000, "rooms": 4, "lat": 51.63865421, "address_1": "20 Deansfield", "lng": -1.86409297, "size": 79, "house_type_out": "Detached House", "postcode": "SN6 6BP" }, "7": { "sold_date": "2016-03-08", "distance": 116, "address_id": 24868681, "current_valuation": 272500, "sold_price": 245000, "rooms": 6, "lat": 51.63865421, "address_1": "59 Deansfield", "lng": -1.86409297, "size": 115, "house_type_out": "Detached House", "postcode": "SN6 6BP" }, "8": { "sold_date": "2016-05-20", "distance": 116, "address_id": 24868657, "current_valuation": 416000, "sold_price": 375000, "rooms": 7, "lat": 51.63865421, "address_1": "37 Deansfield", "lng": -1.86409297, "size": 135, "house_type_out": "Detached House", "postcode": "SN6 6BP" }, "9": { "sold_date": "2015-12-21", "distance": 0, "address_id": 24868780, "current_valuation": 331000, "sold_price": 290000, "rooms": 5, "lat": 51.63916499, "address_1": "62 Deansfield", "lng": -1.86261753, "size": 112, "house_type_out": "Detached House", "postcode": "SN6 6BW" }, "10": { "sold_date": "2015-06-23", "distance": 116, "address_id": 24868645, "current_valuation": 284500, "sold_price": 235000, "rooms": 4, "lat": 51.63865421, "address_1": "26 Deansfield", "lng": -1.86409297, "size": 73, "house_type_out": "Detached House", "postcode": "SN6 6BP" } }, "sales_history_analyze": { "1": { "sold_date": "2017-03-31", "price_chage_percent": 0.326, "sold_price": 250000, "price_change": 81500 } }, "regional_housetype_price_5y": { "TerracedPrice": { "index_10": 176000, "index_11": 176000, "index_12": 177000, "index_13": 181000, "index_14": 187000, "index_15": 190500, "index_16": 191000, "index_17": 193000, "index_18": 196500, "index_19": 197500, "index_30": 211000, "index_31": 217000, "index_29": 210500, "index_28": 212000, "index_21": 202500, "index_20": 203000, "index_23": 204000, "index_22": 198500, "index_25": 207500, "index_24": 202000, "index_27": 213500, "index_26": 215000, "index_8": 175000, "index_9": 179500, "index_6": 167500, "index_7": 169500, "index_4": 169000, "index_5": 167000, "index_2": 165500, "index_3": 170500, "index_1": 165000 }, "FlatPrice": { "index_10": 122000, "index_11": 122000, "index_12": 122500, "index_13": 124500, "index_14": 128500, "index_15": 130500, "index_16": 130500, "index_17": 132500, "index_18": 135500, "index_19": 136000, "index_30": 145500, "index_31": 148000, "index_29": 146500, "index_28": 147500, "index_21": 140500, "index_20": 139500, "index_23": 143000, "index_22": 138500, "index_25": 146500, "index_24": 142500, "index_27": 149000, "index_26": 151000, "index_8": 120000, "index_9": 123500, "index_6": 116000, "index_7": 117000, "index_4": 117000, "index_5": 116000, "index_2": 114000, "index_3": 117500, "index_1": 114500 }, "SemiDetachedPrice": { "index_10": 214500, "index_11": 214500, "index_12": 216000, "index_13": 221000, "index_14": 228500, "index_15": 232500, "index_16": 233500, "index_17": 237500, "index_18": 241500, "index_19": 241000, "index_30": 261000, "index_31": 268500, "index_29": 260500, "index_28": 262000, "index_21": 248500, "index_20": 247500, "index_23": 251000, "index_22": 244500, "index_25": 255500, "index_24": 249000, "index_27": 263500, "index_26": 264500, "index_8": 212500, "index_9": 218000, "index_6": 203500, "index_7": 205500, "index_4": 205000, "index_5": 203000, "index_2": 199500, "index_3": 206500, "index_1": 199000 }, "DetachedPrice": { "index_10": 337500, "index_11": 337500, "index_12": 340500, "index_13": 346500, "index_14": 358000, "index_15": 366500, "index_16": 368000, "index_17": 373500, "index_18": 380000, "index_19": 378000, "index_30": 412000, "index_31": 420000, "index_29": 410500, "index_28": 412000, "index_21": 391500, "index_20": 389500, "index_23": 397000, "index_22": 387500, "index_25": 402000, "index_24": 394000, "index_27": 415000, "index_26": 415500, "index_8": 333000, "index_9": 342500, "index_6": 319000, "index_7": 321000, "index_4": 322500, "index_5": 319000, "index_2": 313500, "index_3": 326500, "index_1": 312500 } }, "predict_price_5y": { "index_10": 265000, "index_11": 265000, "index_12": 267000, "index_13": 273000, "index_14": 282500, "index_15": 287000, "index_16": 288500, "index_17": 293500, "index_18": 298000, "index_19": 298000, "index_30": 322500, "index_31": 331500, "index_29": 322000, "index_28": 324000, "index_21": 307000, "index_20": 306000, "index_23": 310000, "index_22": 302500, "index_25": 316000, "index_24": 307500, "index_27": 325500, "index_26": 327000, "index_8": 262500, "index_9": 269000, "index_6": 251500, "index_7": 254000, "index_4": 253500, "index_5": 251000, "index_2": 246500, "index_3": 255000, "index_1": 246000 } }, "rental_results": { "rental_comparable_properties": { "0": { "distance": 0.578, "available_from": "Available from 10th Nov 2018", "display_address": "Hallsfield Cricklade Swindon SN6", "log": -1.8637, "price": 1285, "num_beds": 4, "num_baths": 2, "lat": 51.6443, "front_image_url": "https://lid.zoocdn.com/354/255/af7abc6bce2ba13ec53dd867b30857e97309995c.jpg", "property_type": "detached", "furnished_state": "unfurnished" }, "1": { "distance": 1.708, "available_from": "Available from 15th May 2018", "display_address": "Cricklade Swindon SN6", "log": -1.8719, "price": 2695, "num_beds": 5, "num_baths": 2, "lat": 51.6249, "front_image_url": "https://lid.zoocdn.com/354/255/4d59f5e3344c39e3ca17307ff21e8b5edce59f7e.jpg", "property_type": "detached", "furnished_state": "unfurnished" }, "2": { "distance": 2.096, "available_from": "Available from 15th Sep 2018", "display_address": "Collett Place Latton Swindon SN6", "log": -1.8685, "price": 2250, "num_beds": 4, "num_baths": 2, "lat": 51.6576, "front_image_url": "https://lid.zoocdn.com/354/255/3d548b1a5c33a1743dc21f3108932cf65e26f52e.jpg", "property_type": "detached", "furnished_state": "unfurnished" }, "3": { "distance": 4.319, "available_from": "Available from 24th Oct 2018", "display_address": "Boatman Close Swindon SN25", "log": -1.8372, "price": 1200, "num_beds": 4, "num_baths": 2, "lat": 51.6037, "front_image_url": "https://lid.zoocdn.com/354/255/be9077b8fd6c9f636ab17ea63006593e75be08af.jpg", "property_type": "house", "furnished_state": "unfurnished" }, "4": { "distance": 4.41, "available_from": "Available from 20th Oct 2018", "display_address": "Ulysses Road Swindon SN25", "log": -1.8342, "price": 1050, "num_beds": 4, "num_baths": 0, "lat": 51.6037, "front_image_url": "https://lid.zoocdn.com/354/255/f2ae02b8b2f1546f36584e6554b48c3e0b6038d2.jpg", "property_type": "town_house", "furnished_state": "unfurnished" }, "5": { "distance": 4.463, "available_from": "Available from 29th Oct 2018", "display_address": "Jason Close Swindon SN25", "log": -1.8367, "price": 725, "num_beds": 2, "num_baths": 1, "lat": 51.6024, "front_image_url": "https://lid.zoocdn.com/354/255/a7bf35e88477eb5f9a6605fe670345701748d63e.jpg", "property_type": "house", "furnished_state": "unfurnished" }, "6": { "distance": 4.887, "available_from": "Available from 29th Nov 2018", "display_address": "Treforest Close Swindon SN25", "log": -1.8274, "price": 1300, "num_beds": 4, "num_baths": 2, "lat": 51.601, "front_image_url": "https://lid.zoocdn.com/354/255/5cbf1988c549b69035e8f5b2555586bece9605d9.jpg", "property_type": "house", "furnished_state": "unfurnished" }, "7": { "distance": 4.966, "available_from": "Available from 5th Nov 2018", "display_address": "High Road Ashton Keynes Swindon SN6", "log": -1.9342, "price": 750, "num_beds": 2, "num_baths": 1, "lat": 51.6437, "front_image_url": "https://lid.zoocdn.com/354/255/c204d5e39776f481743335f5b0e47aeee5574b23.jpg", "property_type": "detached", "furnished_state": "unfurnished" }, "8": { "distance": 4.99, "available_from": "Available from 23rd Oct 2018", "display_address": "Birkdale Close Swindon SN25", "log": -1.8213, "price": 675, "num_beds": 2, "num_baths": 1, "lat": 51.6024, "front_image_url": "https://lid.zoocdn.com/354/255/c3f918b5e2b08a37f1009e25927eedf7f4299026.jpg", "property_type": "house", "furnished_state": "unfurnished" }, "9": { "distance": 5.11, "available_from": "Available from 9th Aug 2018", "display_address": "Dyson Road Redhouse Swindon SN25", "log": -1.8127, "price": 1200, "num_beds": 5, "num_baths": 2, "lat": 51.6052, "front_image_url": "https://lid.zoocdn.com/354/255/23e70fcaa2407b8290ede2a2e9351c9e3486d8ad.jpg", "property_type": "town_house", "furnished_state": "unfurnished" } }, "rental_predict_price": 1025 } },
            valuation: {},
        };
        this.showReport = this.showReport.bind(this);
        this.setValuationFormData = this.setValuationFormData.bind(this);
    }
    showReport(report) {
        this.setState({report:report});
    }

    setValuationFormData(valuation) {
        this.setState({valuation:valuation});
    }

    render() {

     return (
         <React.Fragment>
                <div className="row  ">
                    {(_.isEmpty(this.state.report)) ?
                        <div className="col-4">
                            <div className="card valuation-card">
                                <div className="card-body">
                                    <ValuationForm report={this.showReport}/>
                                </div>

                            </div>
                        </div>
                        :
                        <div className="container">
                        <div className="valuation">
                            <div className="col-12">
                                <div className="card ">
                                    <div className="card-body">
                                        <h1>Your valuation is on its way</h1>
                                        <ValuationReport valuation={this.state.report}/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    }
                </div>
         </React.Fragment>
     );
    }
}


export default QuickValuation;
