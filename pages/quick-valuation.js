import React from "react";
import ValuationForm from '../components/forms/ValuationForm'
import "../styles/valuation.scss";
import ValuationReport from "../components/valuation/ValuationReport";
import _ from "lodash";
import { graphql, compose } from 'react-apollo';
import gql from 'graphql-tag';


class QuickValuation extends React.Component {

    constructor(props) {
        super(props);
        this.state = {
            //report: {},
            report: { "selling_results": { "predict_results": { "predict_price": 331500, "probability": 0.646, "exist_in_epc": false, "predict_price_low": 287500, "band": 0.133, "predict_price_up": 375500, "lat": 51.63916499, "lng": -1.86261753, "confidence_level": 6 }, "query_info": { "address_id": 24868766, "number_habitable_rooms": 5, "built_from": "Semi-Detached", "total_floor_area": 100, "wall_type": "cavity wall", "property_type": "House" }, "regional_price_5y": { "index_10": 224000, "index_11": 224000, "index_12": 225500, "index_13": 230000, "index_14": 238000, "index_15": 242500, "index_16": 243500, "index_17": 247000, "index_18": 251000, "index_19": 251000, "index_30": 271000, "index_31": 277500, "index_29": 270500, "index_28": 272000, "index_21": 259000, "index_20": 258500, "index_23": 262000, "index_22": 255000, "index_25": 266500, "index_24": 260000, "index_27": 274000, "regionname": "Wiltshire", "area_code": "E06000054", "index_8": 221500, "index_9": 227500, "index_6": 212500, "index_7": 214500, "index_4": 214500, "index_5": 212000, "index_2": 209000, "index_3": 216500, "index_1": 208500, "index_26": 275500 }, "local_property_type_statistic": { "Flat_average_value": 0, "Terrace_average_size": 73, "Detached_average_size": 116, "Terrace_average_value": 239500, "Terrace_per_size_value": 3283, "Detached_per_size_value": 3692, "Flat_average_size": 0, "Flat_per_size_value": 0, "Flat_num_ratio": 0, "Semi_Detached_average_value": 258500, "Detached_num_ratio": 0.742, "Terrace_num_ratio": 0.097, "Semi_Detached_average_size": 77, "Semi_Detached_num_ratio": 0.161, "Detached_average_value": 428000, "Semi_Detached_per_size_value": 3357 }, "comparable_properties": { "1": { "sold_date": "2017-11-24", "address_id": 24868810, "current_valuation": 249500, "lat": 51.639165, "sold_price": 245000, "rooms": 5, "distance_to_query_property": 0, "house_type": "Semi-Detached House", "lng": -1.862618, "size": 84, "postcode": "SN6 6BW", "address_1": "92, Deansfield" }, "2": { "sold_date": "2015-10-01", "address_id": 24868793, "current_valuation": 263000, "lat": 51.639165, "sold_price": 228000, "rooms": 4, "distance_to_query_property": 0, "house_type": "Semi-Detached House", "lng": -1.862618, "size": 69, "postcode": "SN6 6BW", "address_1": "75, Deansfield" }, "3": { "sold_date": "2015-05-06", "address_id": 24868790, "current_valuation": 251500, "lat": 51.639165, "sold_price": 205000, "rooms": 5, "distance_to_query_property": 0, "house_type": "Semi-Detached House", "lng": -1.862618, "size": 78, "postcode": "SN6 6BW", "address_1": "72, Deansfield" }, "4": { "sold_date": "2014-08-08", "address_id": 24868808, "current_valuation": 290000, "lat": 51.639165, "sold_price": 229950, "rooms": 6, "distance_to_query_property": 0, "house_type": "Semi-Detached House", "lng": -1.862618, "size": 95, "postcode": "SN6 6BW", "address_1": "90, Deansfield" }, "5": { "sold_date": "2016-12-15", "address_id": 24868684, "current_valuation": 314000, "lat": 51.638654, "sold_price": 290000, "rooms": 5, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 96, "postcode": "SN6 6BP", "address_1": "61, Deansfield" }, "6": { "sold_date": "2016-10-06", "address_id": 24868641, "current_valuation": 337500, "lat": 51.638654, "sold_price": 315000, "rooms": 7, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 98, "postcode": "SN6 6BP", "address_1": "22, Deansfield" }, "7": { "sold_date": "2016-05-20", "address_id": 24868639, "current_valuation": 305000, "lat": 51.638654, "sold_price": 275000, "rooms": 4, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 79, "postcode": "SN6 6BP", "address_1": "20, Deansfield" }, "8": { "sold_date": "2016-03-08", "address_id": 24868681, "current_valuation": 272500, "lat": 51.638654, "sold_price": 245000, "rooms": 6, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 115, "postcode": "SN6 6BP", "address_1": "59, Deansfield" }, "9": { "sold_date": "2016-05-20", "address_id": 24868657, "current_valuation": 416000, "lat": 51.638654, "sold_price": 375000, "rooms": 7, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 135, "postcode": "SN6 6BP", "address_1": "37, Deansfield" }, "10": { "sold_date": "2015-12-21", "address_id": 24868780, "current_valuation": 331000, "lat": 51.639165, "sold_price": 290000, "rooms": 5, "distance_to_query_property": 0, "house_type": "Detached House", "lng": -1.862618, "size": 112, "postcode": "SN6 6BW", "address_1": "62, Deansfield" }, "11": { "sold_date": "2015-06-23", "address_id": 24868645, "current_valuation": 284500, "lat": 51.638654, "sold_price": 235000, "rooms": 4, "distance_to_query_property": 116, "house_type": "Detached House", "lng": -1.864093, "size": 73, "postcode": "SN6 6BP", "address_1": "26, Deansfield" } }, "sales_history_analyze": { "1": { "sold_date": "2017-03-31", "price_chage_percent": 0.326, "sold_price": 250000, "price_change": 81500 } }, "regional_housetype_price_5y": { "DetachedPrice": { "index_10": 337500, "index_11": 337500, "index_12": 340500, "index_13": 346500, "index_14": 358000, "index_15": 366500, "index_16": 368000, "index_17": 373500, "index_18": 380000, "index_19": 378000, "index_30": 412000, "index_31": 420000, "index_29": 410500, "index_28": 412000, "index_21": 391500, "index_20": 389500, "index_23": 397000, "index_22": 387500, "index_25": 402000, "index_24": 394000, "index_27": 415000, "index_26": 415500, "index_8": 333000, "index_9": 342500, "index_6": 319000, "index_7": 321000, "index_4": 322500, "index_5": 319000, "index_2": 313500, "index_3": 326500, "index_1": 312500 }, "TerracedPrice": { "index_10": 176000, "index_11": 176000, "index_12": 177000, "index_13": 181000, "index_14": 187000, "index_15": 190500, "index_16": 191000, "index_17": 193000, "index_18": 196500, "index_19": 197500, "index_30": 211000, "index_31": 217000, "index_29": 210500, "index_28": 212000, "index_21": 202500, "index_20": 203000, "index_23": 204000, "index_22": 198500, "index_25": 207500, "index_24": 202000, "index_27": 213500, "index_26": 215000, "index_8": 175000, "index_9": 179500, "index_6": 167500, "index_7": 169500, "index_4": 169000, "index_5": 167000, "index_2": 165500, "index_3": 170500, "index_1": 165000 }, "SemiDetachedPrice": { "index_10": 214500, "index_11": 214500, "index_12": 216000, "index_13": 221000, "index_14": 228500, "index_15": 232500, "index_16": 233500, "index_17": 237500, "index_18": 241500, "index_19": 241000, "index_30": 261000, "index_31": 268500, "index_29": 260500, "index_28": 262000, "index_21": 248500, "index_20": 247500, "index_23": 251000, "index_22": 244500, "index_25": 255500, "index_24": 249000, "index_27": 263500, "index_26": 264500, "index_8": 212500, "index_9": 218000, "index_6": 203500, "index_7": 205500, "index_4": 205000, "index_5": 203000, "index_2": 199500, "index_3": 206500, "index_1": 199000 }, "FlatPrice": { "index_10": 122000, "index_11": 122000, "index_12": 122500, "index_13": 124500, "index_14": 128500, "index_15": 130500, "index_16": 130500, "index_17": 132500, "index_18": 135500, "index_19": 136000, "index_30": 145500, "index_31": 148000, "index_29": 146500, "index_28": 147500, "index_21": 140500, "index_20": 139500, "index_23": 143000, "index_22": 138500, "index_25": 146500, "index_24": 142500, "index_27": 149000, "index_26": 151000, "index_8": 120000, "index_9": 123500, "index_6": 116000, "index_7": 117000, "index_4": 117000, "index_5": 116000, "index_2": 114000, "index_3": 117500, "index_1": 114500 } }, "predict_price_5y": { "index_10": 265000, "index_11": 265000, "index_12": 267000, "index_13": 273000, "index_14": 282500, "index_15": 287000, "index_16": 288500, "index_17": 293500, "index_18": 298000, "index_19": 298000, "index_30": 322500, "index_31": 331500, "index_29": 322000, "index_28": 324000, "index_21": 307000, "index_20": 306000, "index_23": 310000, "index_22": 302500, "index_25": 316000, "index_24": 307500, "index_27": 325500, "index_26": 327000, "index_8": 262500, "index_9": 269000, "index_6": 251500, "index_7": 254000, "index_4": 253500, "index_5": 251000, "index_2": 246500, "index_3": 255000, "index_1": 246000 } }, "rental_results": { "reantal_comparable_properties": { "0": { "distance": 0.578, "available_from": "Available from 10th Nov 2018", "display_address": "Hallsfield, Cricklade, Swindon SN6", "log": -1.8637, "price": 1285, "num_beds": 4, "num_baths": 2, "lat": 51.644315, "property_type": "detached", "furnished_state": "unfurnished" }, "1": { "distance": 1.708, "available_from": "Available from 15th May 2018", "display_address": "Cricklade, Swindon SN6", "log": -1.871949, "price": 2695, "num_beds": 5, "num_baths": 2, "lat": 51.624939000000005, "property_type": "detached", "furnished_state": "unfurnished" }, "2": { "distance": 2.096, "available_from": "Available from 15th Sep 2018", "display_address": "Collett Place, Latton, Swindon SN6", "log": -1.8685459999999998, "price": 2250, "num_beds": 4, "num_baths": 2, "lat": 51.657646, "property_type": "detached", "furnished_state": "unfurnished" }, "3": { "distance": 4.319, "available_from": "Available from 24th Oct 2018", "display_address": "Boatman Close, Swindon SN25", "log": -1.8371819999999999, "price": 1200, "num_beds": 4, "num_baths": 2, "lat": 51.603695, "property_type": "house", "furnished_state": "unfurnished" }, "4": { "distance": 4.41, "available_from": "Available from 20th Oct 2018", "display_address": "Ulysses Road, Swindon SN25", "log": -1.834207, "price": 1050, "num_beds": 4, "num_baths": 0, "lat": 51.603654999999996, "property_type": "town_house", "furnished_state": "unfurnished" }, "5": { "distance": 4.463, "available_from": "Available from 29th Oct 2018", "display_address": "Jason Close, Swindon SN25", "log": -1.836652, "price": 725, "num_beds": 2, "num_baths": 1, "lat": 51.602426, "property_type": "house", "furnished_state": "unfurnished" }, "6": { "distance": 4.887, "available_from": "Available from 29th Nov 2018", "display_address": "Treforest Close, Swindon SN25", "log": -1.827431, "price": 1300, "num_beds": 4, "num_baths": 2, "lat": 51.601046000000004, "property_type": "house", "furnished_state": "unfurnished" }, "7": { "distance": 4.966, "available_from": "Available from 5th Nov 2018", "display_address": "High Road, Ashton Keynes, Swindon SN6", "log": -1.9341830000000002, "price": 750, "num_beds": 2, "num_baths": 1, "lat": 51.643719, "property_type": "detached", "furnished_state": "unfurnished" }, "8": { "distance": 4.99, "available_from": "Available from 23rd Oct 2018", "display_address": "Birkdale Close, Swindon SN25", "log": -1.821261, "price": 675, "num_beds": 2, "num_baths": 1, "lat": 51.602377000000004, "property_type": "house", "furnished_state": "unfurnished" }, "9": { "distance": 5.11, "available_from": "Available from 9th Aug 2018", "display_address": "Dyson Road, Redhouse, Swindon SN25", "log": -1.812745, "price": 1200, "num_beds": 5, "num_baths": 2, "lat": 51.605232, "property_type": "town_house", "furnished_state": "unfurnished" } }, "reantal_predict_results": 1025 } },
            valuation: {},
        };
        this.showReport = this.showReport.bind(this);
        this.setValuationFormData = this.setValuationFormData.bind(this);
    }
    showReport(report) {
        this.setState({report:report});
    }

    setValuationFormData(valuation) {
        this.setState({valuation:valuation});
    }

    render() {

     return (
         <React.Fragment>
                <div className="row  ">
                    {(_.isEmpty(this.state.report)) ?
                        <div className="col-4">
                            <div className="card valuation-card">
                                <div className="card-body">
                                    <ValuationForm report={this.showReport}/>
                                </div>

                            </div>
                        </div>
                        :
                        <div className="container">
                        <div className="valuation">
                            <div className="col-12">
                                <div className="card ">
                                    <div className="card-body">
                                        <h1>Your valuation is on its way</h1>
                                        <ValuationReport valuation={this.state.report.selling_results}/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    }
                </div>
         </React.Fragment>
     );
    }
}


export default QuickValuation;
